# API设计全局规范

## ```HTTP``` 状态码
1. 状态码不表示业务，当HTTP状态码为```200```或```204```仅代表从网络通信角度来看API是否调用成功。
2. API路由找不到时应该返回状态码```404```。
3. 服务端内部报错应该返回状态码```500```，同时不允许携带任何有关的报错信息。
4. 以上或其它HTTP状态码与HTTP协议规范一致。

<br />

## ```HTTP``` 方法
1. 任何时候都应该只考虑```GET```与```POST```，HTTP方法不应与业务相关。
2. 删/查操作或上传内容较少的请求一般使用```GET```。
3. 增/改操作或上传内容较多的请求一般使用```POST```。

<br />

## 路由设计
1. 所有API只应出现在```/api```下。
2. 应为每个实体单独建立一层路由，实体名使用名词单数形式，例如：
  * ```/api/user```
  * ```/api/company```
3. 实体层路由最多一层
4. 实体层下定义关于实体的操作，使用动词表达，例如：
  * ```/api/user/add```
  * ```/api/user/delete```
  * ```/api/user/get```
5. 路由命名遵循[RFC3986](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier)，即全部小写横杠```-```分割。
6. 单参数接口可以把参数拼到path末尾，单需要保证拼结，例如：
  * ```/api/user/delete/16```
  * ```/api/user/get/24```

<br />

## 请求头 (Request Headers)

#### ```X-Api-Version```
任何时候都必须携带的头，遵循[语意化版本(Semantic Versioning)](https://semver.org/)规范，指定一个匹配范围。例如：```1.x```代表希望调用主版本号为```1```，其余任意匹配。如果API被调用时不支持或未匹配到对应版本，HTTP响应内容应为空，响应码应为```204```，并且应返回```X-Api-Error-Code```头，其值为```ERR_NONE_MATCHED_VERSION```，如果只是版本号书写的语法错误则应该设置为```ERR_BAD_REQUEST```，并且包含进一步信息帮助修正。前端可以依据错误代码提示用户应升级客户端或刷新界面。

#### ```X-Api-Authorization```
一个用户在登陆之后向服务发起调用时携带的用户身份验证令牌，如果API未做身份验证时可以不携带此头。格式一般由服务器签发给用户时决定。如果API验证这个令牌不通过（解密失败）需要返回HTTP响应码```204```，并且应返回```X-Api-Error-Code```头，其值为```ERR_INVALID_TOKEN```，如果解析成功但是令牌已过期则需要设置为```ERR_EXPIRED_TOKEN```。前端可以根据错误代码跳转到登陆或进行提示。

<br />

## 响应头 (Response Headers)

#### ```X-Api-Error-Code```
如果这个头不存在或者是空字符串则代表API调用成功，否则就是具体的错误代码，请参考错误代码章节。如果调用成功则HTTP响应代码应该是```200```或```204```，如果是```200```则对应的响应体为本次API的返回数据，以```JSON```格式体现。如果API调用失败则与成功时返回的响应码和结构相同，只不过响应体代表了关于这次失败的具体说明。

<br />

## 全局错误代码

#### ```ERR_BAD_REQUEST```
错误的请求，可能由于参数格式，个数，类型错误导致，或由请求方的其它原因导致的错误。响应体应该携带关于这次错误的具体原因。

#### ```ERR_NONE_MATCHED_VERSION```
所请求的版本没有匹配到，响应体中建议包含API的当前版本号作为建议和参考。如果仅是格式不正确应该返回```ERR_BAD_REQUEST```。

#### ```ERR_INVALID_TOKEN```
无效的用户令牌，可能是服务的jwt密钥发生改变，也可能是中间人篡改了令牌。如果仅是格式不正确应该返回```ERR_BAD_REQUEST```。

#### ```ERR_EXPIRED_TOKEN```
用户令牌解析成功，但是发现已过期。

